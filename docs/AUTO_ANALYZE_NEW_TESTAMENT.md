# 신약 성경 전체 자동 분석 프롬프트

## 🎯 목표
신약 성경 전체 27권 중 빌립보서와 갈라디아서를 제외한 25권을 완전 자동으로 분석하여 Supabase에 업로드합니다.

## 📋 작업 대상 (25권, 약 7,000+ 구절)

### 복음서 (4권)
1. Matthew (마태복음) - 1,071구절
2. Mark (마가복음) - 678구절
3. Luke (누가복음) - 1,151구절
4. John (요한복음) - 879구절

### 사도행전 (1권)
5. Acts (사도행전) - 1,007구절

### 바울서신 (12권, 빌립보서/갈라디아서 제외)
6. Romans (로마서) - 433구절
7. 1 Corinthians (고린도전서) - 437구절
8. 2 Corinthians (고린도후서) - 257구절
9. Ephesians (에베소서) - 155구절
10. ~~Philippians (빌립보서) - 104구절~~ ✅ 완료
11. Colossians (골로새서) - 95구절
12. 1 Thessalonians (데살로니가전서) - 89구절
13. 2 Thessalonians (데살로니가후서) - 47구절
14. 1 Timothy (디모데전서) - 113구절
15. 2 Timothy (디모데후서) - 83구절
16. Titus (디도서) - 46구절
17. Philemon (빌레몬서) - 25구절
18. ~~Galatians (갈라디아서) - 149구절~~ ✅ 완료

### 일반서신 (8권)
19. Hebrews (히브리서) - 303구절
20. James (야고보서) - 108구절
21. 1 Peter (베드로전서) - 105구절
22. 2 Peter (베드로후서) - 61구절
23. 1 John (요한1서) - 105구절
24. 2 John (요한2서) - 13구절
25. 3 John (요한3서) - 14구절
26. Jude (유다서) - 25구절

### 요한계시록 (1권)
27. Revelation (요한계시록) - 404구절

**총 예상 구절:** 약 7,157구절 (빌립보서/갈라디아서 제외)

---

## 🚀 완전 자동 실행 프롬프트

```
신약 성경 전체 자동 분석을 시작합니다.

## 작업 지시사항

**중요: 이 작업은 완전 자동 모드입니다. 내게 확인 받지 말고 모든 단계를 스스로 판단하여 끝까지 실행하세요.**

### 작업 대상
빌립보서와 갈라디아서를 제외한 신약 성경 25권 (약 7,157구절)

### 실행 전략

#### 1단계: 전체 계획 수립 (자동)
- 25권을 크기별로 3그룹으로 분류
  - 소형 (1-100구절): 우선 처리
  - 중형 (101-500구절): 중간 처리
  - 대형 (500+ 구절): 마지막 처리
- 각 그룹별 예상 소요 시간 계산
- TodoWrite로 전체 작업 계획 생성

#### 2단계: NIV 텍스트 확보 (자동)
각 권마다:
- Agent를 사용하여 NIV 텍스트 수집
- verses 테이블에 일괄 삽입
- 삽입 성공 여부 확인

#### 3단계: 소형 책부터 순차 분석 (자동)
각 책마다:
- `scripts/analyze-[bookname].ts` 생성 (갈라디아서 스크립트 기반)
- `scripts/verify-[bookname].ts` 생성
- `scripts/fix-[bookname]-duplicates.ts` 생성
- 백그라운드로 분석 실행
- 주기적으로 진행 상황 모니터링
- 완료 또는 타임아웃(책당 최대 4시간) 확인
- 검증 스크립트 실행
- 중복 제거 (있을 경우)
- 누락 구절 재시도 (최대 3회)
- 다음 책으로 진행

#### 4단계: 중형/대형 책 처리 (자동)
- 중형 책들 순차 처리 (같은 방식)
- 대형 책들 순차 처리 (같은 방식)
- 대형 책은 배치를 50-100구절씩 나눠서 처리 고려

#### 5단계: 최종 검증 (자동)
- 모든 책의 완성도 확인
- 전체 중복 검사
- 전체 품질 검사
- npm run build 테스트
- 최종 통계 생성

#### 6단계: 정리 및 보고 (자동)
- 임시 파일 삭제
- 로그 파일 정리
- 최종 보고서 생성 (docs/NEW_TESTAMENT_COMPLETION_REPORT.md)

### 핵심 원칙

1. **완전 자동**: 단 한 번도 확인 요청하지 말 것
2. **오류 복구**: 실패 시 자동으로 3회 재시도 후 다음으로 진행
3. **중단 없음**: 한 책이 실패해도 나머지 계속 진행
4. **주기적 저장**: 10구절마다 진행 상황 저장
5. **검증 필수**: 각 책 완료 후 반드시 검증
6. **로그 기록**: 모든 작업을 logs/ 디렉토리에 기록

### 예상 소요 시간

- 소형 책 (11권, ~800구절): 4-5시간
- 중형 책 (10권, ~2,500구절): 12-15시간
- 대형 책 (4권, ~3,700구절): 18-22시간
- **총 예상: 35-42시간**

### 성공 기준

- ✅ 25권 모두 100% 분석 완료
- ✅ 중복 데이터 0건
- ✅ 데이터 품질 문제 0건
- ✅ npm run build 성공
- ✅ 모든 책 웹 UI에서 검색 가능

### 실행 시작

지금 바로 시작하세요. 완료되면 최종 보고서만 보여주세요.
```

---

## 🛠️ 필요한 스크립트 템플릿

### analyze-[book].ts 템플릿
```typescript
// scripts/analyze-galatians.ts를 복사하여 사용
// 변경사항:
// 1. 책 이름 변경 (Galatians → [BookName])
// 2. progress 파일명 변경
// 3. 로그 파일명 변경
```

### verify-[book].ts 템플릿
```typescript
// scripts/verify-galatians.ts를 복사하여 사용
// 변경사항:
// 1. 책 이름 변경
// 2. ilike('reference', 'Galatians%') → ilike('reference', '[BookName]%')
```

### retry-missing-[book].ts 템플릿
```typescript
// scripts/retry-missing.ts를 복사하여 사용
// 변경사항:
// 1. 책 이름 변경
// 2. 누락 ID 배열을 동적으로 가져오도록 수정
```

---

## 📊 진행 상황 추적

각 책마다 다음 정보를 기록:
```json
{
  "book": "Romans",
  "total_verses": 433,
  "completed": 433,
  "failed": 0,
  "duplicates_removed": 5,
  "start_time": "2025-10-02T10:00:00Z",
  "end_time": "2025-10-02T12:30:00Z",
  "duration_minutes": 150,
  "status": "completed"
}
```

---

## 🔧 문제 해결 전략

### API Rate Limit
- 각 구절마다 5초 대기
- 오버로드 시 exponential backoff (5s → 10s → 20s)
- 최대 3회 재시도

### 중복 데이터
- 각 책 완료 후 자동으로 fix-duplicates 스크립트 실행
- 중복 제거 후 재검증

### 누락 구절
- verify 스크립트로 누락 확인
- retry-missing 스크립트로 자동 재시도
- 3회 실패 시 별도 리스트에 기록하고 계속 진행

### 프로세스 중단
- 각 책마다 백그라운드 실행
- 4시간 타임아웃 설정
- 타임아웃 시 현재 상태 저장 후 다음 책으로

---

## 📝 최종 보고서 형식

```markdown
# 신약 성경 전체 분석 완료 보고서

## 전체 통계
- 총 처리 권수: 25/25
- 총 구절 수: 7,157/7,157 (100%)
- 총 소요 시간: XX시간 XX분
- 성공률: 100%

## 권별 상세 결과
[각 책마다 완성도, 소요시간, 문제 사항 등]

## 데이터 품질
- 중복 제거: XX건
- 재시도 성공: XX건
- 최종 실패: 0건

## 다음 단계
- 구약 성경 분석
- 추가 번역본 추가
- UI 개선
```

---

## 🎯 실행 체크리스트

- [ ] 환경 변수 확인 (.env)
- [ ] Supabase 연결 확인
- [ ] Claude API 키 확인
- [ ] 디스크 공간 확인 (최소 5GB)
- [ ] 안정적인 인터넷 연결
- [ ] 충분한 실행 시간 확보 (35-42시간)

---

## 💡 최적화 제안

### 병렬 처리 (선택사항)
- 2-3권을 동시에 처리하여 시간 단축
- 각 권마다 별도 프로세스로 실행
- API rate limit 고려하여 간격 조정

### 배치 처리 (대형 책)
- 500+ 구절 책은 50-100구절씩 배치로 나눔
- 각 배치 완료 후 체크포인트
- 실패한 배치만 재시도

---

**이 프롬프트를 Claude Code에 입력하면 신약 성경 25권이 완전 자동으로 분석됩니다.**
