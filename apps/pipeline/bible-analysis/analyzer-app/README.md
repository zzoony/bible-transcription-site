# 성경 분석 자동화 앱

macOS 전용 성경 구절 자동 분석 도구입니다.

## 🎯 기능

- 📊 **실시간 진행도 대시보드**: 66권 성경의 분석 진행 상황 실시간 표시
- 📖 **카드 기반 선택**: 여러 책을 선택하여 일괄 분석
- 🤖 **완전 자동화**: 20개씩 배치로 고속 병렬 분석 ⚡
- 📈 **진행도 추적**: 각 책의 완료율 및 예상 소요 시간 표시
- 🔄 **실시간 모니터링**: 분석 진행 상황 실시간 업데이트

## 📁 구조

```plaintext
analyzer-app/
├── package.json           # Electron 앱 설정
├── scripts/
│   └── extract-verse-counts.js  # 구절 수 추출 스크립트
├── src/
│   ├── main.js           # Electron 메인 프로세스
│   ├── index.html        # 대시보드 UI
│   ├── styles.css        # 스타일링
│   ├── renderer.js       # 앱 로직
│   ├── bible-structure.json  # 성경 66권 데이터
│   └── verse-counts.json     # 각 책/장별 실제 구절 수 (17KB)
└── README.md
```

## 🚀 실행 방법

### 1. 앱 시작

```bash
# bible-analysis 폴더에서
cd analyzer-app
npm start
```

### 2. 개발 모드 (콘솔 포함)

```bash
npm run dev
```

## 📖 사용 방법

### 1단계: 책 선택
- 대시보드에서 분석하고 싶은 성경 책을 클릭
- 여러 책 선택 가능
- 이미 완료된 구절은 자동으로 제외됨

### 2단계: 분석 시작
- "🚀 자동 분석 시작" 버튼 클릭
- 선택된 책들이 순차적으로 분석됨

### 3단계: 진행 상황 모니터링
- 실시간으로 진행도 확인
- 현재 배치 정보 표시
- 예상 남은 시간 표시

## ⚙️ 동작 방식

1. **정확한 구절 수**: NIV 원문에서 추출한 실제 구절 수 사용 (없는 구절 분석 방지) ⭐
2. **안정적 병렬 처리**: 10개 구절씩 동시 실행 (안정성 우선) ⚡
3. **백그라운드 실행**: 터미널 창 없이 앱 내부에서 직접 실행 ⭐
4. **넉넉한 대기 시간**: JSON 파일 생성을 최대 5분까지 대기 (복잡한 구절 대응)
5. **진행도 추적**: 2초마다 JSON 파일 생성 확인
6. **로그**: 개발 모드(`npm run dev`)에서 콘솔로 확인

## 🎨 UI 요소

### 대시보드
- **전체 진행도**: 31,102개 구절 중 완료된 구절 수
- **필터**: 구약/신약/전체 선택
- **책 카드**: 각 책의 진행도와 구절 수 표시

### 분석 진행 패널
- **현재 배치**: 현재 처리 중인 책과 배치 번호
- **통계**: 완료/처리 중/대기 구절 수
- **최근 완료**: 마지막 10개 완료 구절 목록

## 🔍 문제 해결

### Q: 앱이 실행되지 않아요
```bash
# Electron 재설치
cd analyzer-app
rm -rf node_modules
npm install
npm start
```

### Q: 진행도가 업데이트되지 않아요
- "🔄 새로고침" 버튼 클릭
- 앱을 종료했다가 다시 시작

### Q: 분석이 시작되지 않아요
- `claude` 명령어가 설치되어 있는지 확인:
  ```bash
  which claude
  ```
- 콘솔 로그 확인: `npm run dev`
- ANALYZE_VERSE_PROMPT.txt 파일 존재 확인

### Q: 예상 시간이 정확하지 않아요
- 초기에는 추정치가 부정확할 수 있습니다
- 몇 개 배치가 완료되면 점점 정확해집니다

### Q: 구절 수 데이터를 업데이트하려면?
```bash
# NIV Bible에서 최신 구절 수 추출
cd analyzer-app
node scripts/extract-verse-counts.js
# src/verse-counts.json 파일이 업데이트됩니다
```

### Q: 배치 크기를 조정하려면?
`src/renderer.js` 파일에서 `BATCH_SIZE` 값 수정:

```javascript
// 배치 크기 설정 (안정성 우선)
const BATCH_SIZE = 10; // 원하는 크기로 변경
```

**권장 값**:
- **5개**: 매우 안전, 저사양 또는 복잡한 구절이 많을 때
- **10개**: 추천, 안정성과 속도 균형 ⭐
- **15개**: 고성능 (16GB+ RAM)
- **20개+**: 위험, 일부 구절 타임아웃 가능성

## 📊 성능

- **메모리 사용**: ~150MB (Electron 앱 기본) + 병렬 프로세스 ~2GB
- **CPU 사용**: 중간 (10개 병렬 처리, 안정성 우선)
- **동시 처리**: 배치당 **10개 구절 병렬 처리** ⚡
- **터미널**: 0개 (완전 백그라운드 실행) ⭐
- **구절당 소요**: 평균 2-3분, 최대 5분 대기 (복잡한 구절 대응)
- **타임아웃**: 5분 (복잡한 신학적 내용도 처리 가능)
- **데이터 크기**: 구절 수 데이터 17KB (NIV 원본 4.5MB 대비 99.6% 절감)
- **권장 환경**: Mac Mini M4 16GB RAM 또는 유사 사양

## 🛡️ 주의사항

1. **분석 중에는 책 선택 변경 불가**
2. **완료 감지**: JSON 파일 생성 완료 시 자동 진행
3. **로그 확인**: `npm run dev`로 실행하면 콘솔에서 진행 상황 확인
4. **중단하려면 "⏹️ 중단" 버튼 사용**
5. **터미널 창 없음**: 모든 작업이 백그라운드에서 실행됨 ⭐

## 🎯 실패 처리 시스템 ⭐

### 자동 재시도
- 각 구절 실패 시 자동으로 **3회 재시도**
- 5초 간격으로 재시도
- 재시도 중 콘솔에 진행 상황 표시

### 실패 통계
- 실패한 구절 수를 UI에 실시간 표시
- 배치 완료 시 성공/실패 카운트 출력
- 최종 완료 시 실패 목록 알림

### 재분석 기능
- "🔄 실패한 것만 재분석" 버튼 제공
- 실패한 구절만 다시 분석
- 재분석도 3회 재시도 적용

### 장점
- ✅ 실패해도 분석 중단 안 됨
- ✅ 일시적 오류 자동 해결
- ✅ 최대한 많은 구절 분석
- ✅ 실패 목록 추적 및 재분석 가능

## 🎯 향후 개선 사항

- [ ] 일시정지/재개 기능
- [ ] 로그 파일 저장
- [ ] macOS 알림 통합
- [ ] 배치 크기 조정 옵션
- [x] 실패한 구절 자동 재시도 ✅
- [x] 실패 목록 추적 및 재분석 ✅
- [x] NIV 원문 기반 정확한 구절 수 사용 ✅

## 📝 로그

콘솔 로그는 개발 모드에서 확인:
```bash
npm run dev
```

## 📚 관련 문서

- **스크립트 가이드**: `docs/SCRIPTS_GUIDE.md`
  - analyzer-app 사용법
  - JSON → DB 업로드 방법
  - NIV 원문 조회 도구
  - 품질 평가 도구
  - 전체 워크플로우

## 🆘 지원

문제가 발생하면:
1. 콘솔 로그 확인 (`npm run dev`)
2. `analysis-json/` 폴더 확인
3. 스크립트 실행 권한 확인
4. 스크립트 가이드 참조 (`docs/SCRIPTS_GUIDE.md`)

---

**만든이**: Bible Analysis Team
**버전**: v1.0.4
**라이선스**: MIT

## 📝 버전 히스토리

### v1.0.4 (최신)
- CodeRabbit 리뷰 반영: 에러 핸들링, 프로세스 정리, 경쟁 조건 해결
- 각 구절마다 고유한 임시 파일 생성 (UUID 사용)
- 프로세스 추적 및 중단 시 자동 정리
- 임시 파일 자동 삭제
- 마크다운 코드 블록 언어 지정

### v1.0.3
- 배치 크기 감소 (20 → 10개, 안정성 우선)
- 타임아웃 증가 (2분 → 5분, 복잡한 구절 대응)
- Claude 도구 명시적 허용 (Write, Read)
- 재분석 버튼 재활성화 수정
- 창 드래그 기능 추가

### v1.0.2
- 워커 풀 패턴 구현 (항상 10개 동시 실행)
- 파일 생성 검증 로직 추가

### v1.0.1
- NIV 원문 기반 정확한 구절 수 사용
- 배치 크기 증가 (10 → 20개)

### v1.0.0
- 초기 릴리스
- 66권 성경 카드 UI
- 자동 배치 분석 시스템
