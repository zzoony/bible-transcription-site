(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[580],{8411:function(e,s,t){Promise.resolve().then(t.bind(t,7771))},7771:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var r=t(7573),a=t(7653),n=t(1695),l=t(649),i=t(6798),o=t(9369);function c(e){let{reference:s,book:t,chapter:a,verse:n,text:l,snippet:c,onClick:d,className:u}=e,h=(c||l).replace(/<mark>(.*?)<\/mark>/g,'<mark class="bg-yellow-200 dark:bg-yellow-900 font-semibold">$1</mark>');return(0,r.jsx)(i.Zb,{className:(0,o.cn)("cursor-pointer transition-all hover:shadow-md hover:border-primary/50",u),onClick:d,"data-testid":"verse-card",children:(0,r.jsxs)(i.aY,{className:"pt-6",children:[(0,r.jsxs)("div",{className:"mb-3 text-sm font-semibold text-primary","data-testid":"verse-reference",children:[t," ",a,":",n]}),(0,r.jsx)("div",{className:"text-base leading-relaxed","data-testid":"verse-text",dangerouslySetInnerHTML:{__html:h}})]})})}var d=t(6273),u=t(8410),h=t(2966);function m(e){let{results:s,total:t,limit:a,offset:n,hasMore:l,query:i,isLoading:o=!1,onPageChange:m,onResultClick:f,className:x}=e,p=Math.floor(n/a)+1,v=Math.ceil(t/a);return o?(0,r.jsx)("div",{className:"flex items-center justify-center py-12","data-testid":"search-loading",children:(0,r.jsx)("div",{className:"text-muted-foreground",children:"Searching..."})}):0===s.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,r.jsx)("p",{className:"text-lg text-muted-foreground",children:"No results found"}),i&&(0,r.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Try searching with different keywords"})]}):(0,r.jsxs)("div",{className:x,children:[(0,r.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,r.jsxs)("span",{"data-testid":"total-results",children:[t.toLocaleString()," ",1===t?"result":"results"]}),i&&(0,r.jsxs)("span",{children:[" ","for ",(0,r.jsx)("span",{className:"font-semibold text-foreground",children:i})]})]}),v>1&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",p," of ",v]})]}),(0,r.jsx)("div",{className:"space-y-4","data-testid":"results-list",children:s.map(e=>(0,r.jsx)("div",{"data-testid":"search-result",children:(0,r.jsx)(c,{reference:e.reference,book:e.book,chapter:e.chapter,verse:e.verse,text:e.text,snippet:e.snippet,onClick:()=>null==f?void 0:f(e.reference)})},e.reference))}),v>1&&(0,r.jsxs)("div",{className:"mt-8 flex items-center justify-center gap-2",children:[(0,r.jsxs)(d.z,{variant:"outline",size:"default",onClick:()=>{n>0&&(null==m||m(Math.max(0,n-a)))},disabled:0===n,"data-testid":"prev-page",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Previous"]}),(0,r.jsx)("div",{className:"flex items-center gap-2 px-4",children:(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",p," of ",v]})}),(0,r.jsxs)(d.z,{variant:"outline",size:"default",onClick:()=>{l&&(null==m||m(n+a))},disabled:!l,"data-testid":"next-page",children:["Next",(0,r.jsx)(h.Z,{className:"h-4 w-4 ml-2"})]})]})]})}var f=t(1867),x=t(3040),p=t(1501);function v(){let e=(0,n.useSearchParams)(),s=(0,n.useRouter)(),{results:t,total:i,limit:c,offset:u,hasMore:h,query:v,filters:b,isLoading:g,error:j,search:k,setQuery:N,setFilters:_}=function(){let[e,s]=(0,a.useState)({query:"",filters:{},results:[],total:0,limit:10,offset:0,hasMore:!1,isLoading:!1,error:null}),t=(0,a.useCallback)(async t=>{let r=t.q||e.query,a=t.limit||e.limit,n=t.offset||e.offset,l=t.book,i=t.chapter;if(!r.trim()){s(e=>({...e,error:"Query is required"}));return}s(e=>({...e,isLoading:!0,error:null}));try{let e=(0,f.S2)().from("verses").select("\n            reference,\n            niv_text,\n            verse_number,\n            books!inner(name_english),\n            chapters!inner(chapter_number)\n          ",{count:"exact"});"*"!==r&&(e=e.textSearch("niv_text",r,{type:"websearch",config:"english"})),l&&(e=e.eq("books.name_english",l)),void 0!==i&&(e=e.eq("chapters.chapter_number",i));let{data:t,error:c,count:d}=await e;if(c)throw c;let u=d||0,h=(null==t?void 0:t.map(e=>{let s=(0,o.rt)(e.reference);return{reference:e.reference,book:(null==s?void 0:s.book)||e.books.name_english,chapter:(null==s?void 0:s.chapter)||e.chapters.chapter_number,verse:(null==s?void 0:s.verse)||e.verse_number,text:e.niv_text,snippet:e.niv_text}}))||[];h.sort((e,s)=>e.chapter!==s.chapter?e.chapter-s.chapter:e.verse-s.verse);let m=h.slice(n,n+a),x=n+a<u;s({query:r,filters:{book:l,chapter:i},results:m,total:u,limit:a,offset:n,hasMore:x,isLoading:!1,error:null})}catch(e){console.error("Search error:",e),s(s=>({...s,isLoading:!1,error:e instanceof Error?e.message:"Search failed"}))}},[e.query,e.limit,e.offset]),r=(0,a.useCallback)(()=>{s({query:"",filters:{},results:[],total:0,limit:10,offset:0,hasMore:!1,isLoading:!1,error:null})},[]),n=(0,a.useCallback)(e=>{s(s=>({...s,query:e}))},[]),l=(0,a.useCallback)(e=>{s(s=>({...s,filters:e}))},[]),i=(0,a.useCallback)(()=>{e.hasMore&&t({offset:e.offset+e.limit})},[e.hasMore,e.offset,e.limit,t]),c=(0,a.useCallback)(()=>{e.offset>0&&t({offset:Math.max(0,e.offset-e.limit)})},[e.offset,e.limit,t]);return{...e,search:t,clear:r,setQuery:n,setFilters:l,nextPage:i,previousPage:c}}(),S=e.get("q"),y=e.get("book"),C=e.get("chapter"),P=e.get("offset");return(0,a.useEffect)(()=>{if(S){let e=(0,p.pD)(S);e.isBookName&&e.book?(N(""),_({book:e.book}),k({q:"*",book:e.book,chapter:C?parseInt(C):void 0,offset:P?parseInt(P):0})):(N(S),k({q:S,book:y||void 0,chapter:C?parseInt(C):void 0,offset:P?parseInt(P):0}))}},[S,y,C,P]),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(l.E,{onSearch:e=>{let t=new URLSearchParams;t.set("q",e),b.book&&t.set("book",b.book),b.chapter&&t.set("chapter",b.chapter.toString()),s.push("/search?".concat(t.toString()))},defaultValue:v,placeholder:"Search for Bible verses..."})}),(0,r.jsxs)("div",{className:"mb-6 flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Book:"}),(0,r.jsxs)(x.Ph,{value:b.book||"all",onValueChange:e=>{let t=new URLSearchParams;t.set("q",v),e&&"all"!==e?(t.set("book",e),_({...b,book:e})):_({...b,book:void 0}),s.push("/search?".concat(t.toString()))},children:[(0,r.jsx)(x.i4,{className:"w-[180px]",children:(0,r.jsx)(x.ki,{placeholder:"All Books"})}),(0,r.jsxs)(x.Bw,{children:[(0,r.jsx)(x.Ql,{value:"all",children:"All Books"}),(0,r.jsx)(x.Ql,{value:"Philippians",children:"Philippians"}),(0,r.jsx)(x.Ql,{value:"Genesis",children:"Genesis"}),(0,r.jsx)(x.Ql,{value:"John",children:"John"}),(0,r.jsx)(x.Ql,{value:"Romans",children:"Romans"}),(0,r.jsx)(x.Ql,{value:"Psalms",children:"Psalms"})]})]})]}),(b.book||b.chapter)&&(0,r.jsx)(d.z,{variant:"outline",size:"sm",onClick:()=>{_({}),s.push("/search?q=".concat(encodeURIComponent(v)))},children:"Clear Filters"})]}),j&&(0,r.jsx)("div",{className:"mb-6 rounded-md border border-destructive bg-destructive/10 p-4",children:(0,r.jsx)("p",{className:"text-sm text-destructive",children:j})}),(0,r.jsx)(m,{results:t,total:i,limit:c,offset:u,hasMore:h,query:v,isLoading:g,onPageChange:e=>{let t=new URLSearchParams;t.set("q",v),t.set("offset",e.toString()),b.book&&t.set("book",b.book),b.chapter&&t.set("chapter",b.chapter.toString()),s.push("/search?".concat(t.toString()))},onResultClick:e=>{s.push("/verse/".concat(e))}})]})}function b(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"로딩 중..."})}),children:(0,r.jsx)(v,{})})}},1867:function(e,s,t){"use strict";t.d(s,{S2:function(){return l}});var r=t(5035),a=t(4859);let n=null;function l(){return n||(n=(0,r.eI)(function(){let e=a.env.NEXT_PUBLIC_SUPABASE_URL;if(!e)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");return e}(),function(){let e=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");return e}(),{auth:{persistSession:!1},db:{schema:"public"},global:{headers:{"x-application-name":"bible-transcription-site"}}})),n}l()}},function(e){e.O(0,[432,104,141,96,387,293,528,744],function(){return e(e.s=8411)}),_N_E=e.O()}]);