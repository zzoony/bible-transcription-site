(()=>{var e={};e.id=580,e.ids=[580],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},3409:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),s(3772),s(7093),s(3921);var r=s(3282),a=s(5736),l=s(3906),i=s.n(l),n=s(6880),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(t,o);let c=["",{children:["(main)",{children:["search",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3772)),"/Users/peter/Dev/bible-transcription-site/apps/web/app/(main)/search/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,7093)),"/Users/peter/Dev/bible-transcription-site/apps/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,3921)),"/Users/peter/Dev/bible-transcription-site/apps/web/app/not-found.tsx"]}],d=["/Users/peter/Dev/bible-transcription-site/apps/web/app/(main)/search/page.tsx"],u="/(main)/search/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/search/page",pathname:"/search",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5347:(e,t,s)=>{Promise.resolve().then(s.bind(s,4827))},4827:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var r=s(3227),a=s(3677),l=s(1043),i=s(1373),n=s(1009),o=s(8969);function c({reference:e,book:t,chapter:s,verse:a,text:l,snippet:i,onClick:c,className:d}){let u=(i||l).replace(/<mark>(.*?)<\/mark>/g,'<mark class="bg-yellow-200 dark:bg-yellow-900 font-semibold">$1</mark>');return r.jsx(n.Zb,{className:(0,o.cn)("cursor-pointer transition-all hover:shadow-md hover:border-primary/50",d),onClick:c,"data-testid":"verse-card",children:(0,r.jsxs)(n.aY,{className:"pt-6",children:[(0,r.jsxs)("div",{className:"mb-3 text-sm font-semibold text-primary","data-testid":"verse-reference",children:[t," ",s,":",a]}),r.jsx("div",{className:"text-base leading-relaxed","data-testid":"verse-text",dangerouslySetInnerHTML:{__html:u}})]})})}var d=s(7403),u=s(5435),m=s(5749);function p({results:e,total:t,limit:s,offset:a,hasMore:l,query:i,isLoading:n=!1,onPageChange:o,onResultClick:p,className:f}){let x=Math.floor(a/s)+1,h=Math.ceil(t/s);return n?r.jsx("div",{className:"flex items-center justify-center py-12","data-testid":"search-loading",children:r.jsx("div",{className:"text-muted-foreground",children:"Searching..."})}):0===e.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[r.jsx("p",{className:"text-lg text-muted-foreground",children:"No results found"}),i&&r.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Try searching with different keywords"})]}):(0,r.jsxs)("div",{className:f,children:[(0,r.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,r.jsxs)("span",{"data-testid":"total-results",children:[t.toLocaleString()," ",1===t?"result":"results"]}),i&&(0,r.jsxs)("span",{children:[" ","for ",r.jsx("span",{className:"font-semibold text-foreground",children:i})]})]}),h>1&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",x," of ",h]})]}),r.jsx("div",{className:"space-y-4","data-testid":"results-list",children:e.map(e=>r.jsx("div",{"data-testid":"search-result",children:r.jsx(c,{reference:e.reference,book:e.book,chapter:e.chapter,verse:e.verse,text:e.text,snippet:e.snippet,onClick:()=>p?.(e.reference)})},e.reference))}),h>1&&(0,r.jsxs)("div",{className:"mt-8 flex items-center justify-center gap-2",children:[(0,r.jsxs)(d.z,{variant:"outline",size:"default",onClick:()=>{a>0&&o?.(Math.max(0,a-s))},disabled:0===a,"data-testid":"prev-page",children:[r.jsx(u.Z,{className:"h-4 w-4 mr-2"}),"Previous"]}),r.jsx("div",{className:"flex items-center gap-2 px-4",children:(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",x," of ",h]})}),(0,r.jsxs)(d.z,{variant:"outline",size:"default",onClick:()=>{l&&o?.(a+s)},disabled:!l,"data-testid":"next-page",children:["Next",r.jsx(m.Z,{className:"h-4 w-4 ml-2"})]})]})]})}var f=s(7517),x=s(1563);function h(){let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),{results:s,total:n,limit:c,offset:u,hasMore:m,query:h,filters:b,isLoading:g,error:v,search:j,setQuery:N,setFilters:y}=function(){let[e,t]=(0,a.useState)({query:"",filters:{},results:[],total:0,limit:10,offset:0,hasMore:!1,isLoading:!1,error:null}),s=(0,a.useCallback)(async s=>{let r=s.q||e.query,a=s.limit||e.limit,l=s.offset||e.offset,i=s.book,n=s.chapter;if(!r.trim()){t(e=>({...e,error:"Query is required"}));return}t(e=>({...e,isLoading:!0,error:null}));try{let e=(0,f.S2)().from("verses").select(`
            reference,
            niv_text,
            verse_number,
            books!inner(name_english),
            chapters!inner(chapter_number)
          `,{count:"exact"});"*"!==r&&(e=e.textSearch("niv_text",r,{type:"websearch",config:"english"})),i&&(e=e.eq("books.name_english",i)),void 0!==n&&(e=e.eq("chapters.chapter_number",n));let{data:s,error:c,count:d}=await e;if(c)throw c;let u=d||0,m=s?.map(e=>{let t=o.rt(e.reference);return{reference:e.reference,book:t?.book||e.books.name_english,chapter:t?.chapter||e.chapters.chapter_number,verse:t?.verse||e.verse_number,text:e.niv_text,snippet:e.niv_text}})||[];m.sort((e,t)=>e.chapter!==t.chapter?e.chapter-t.chapter:e.verse-t.verse);let p=m.slice(l,l+a),x=l+a<u;t({query:r,filters:{book:i,chapter:n},results:p,total:u,limit:a,offset:l,hasMore:x,isLoading:!1,error:null})}catch(e){console.error("Search error:",e),t(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Search failed"}))}},[e.query,e.limit,e.offset]),r=(0,a.useCallback)(()=>{t({query:"",filters:{},results:[],total:0,limit:10,offset:0,hasMore:!1,isLoading:!1,error:null})},[]),l=(0,a.useCallback)(e=>{t(t=>({...t,query:e}))},[]),i=(0,a.useCallback)(e=>{t(t=>({...t,filters:e}))},[]),n=(0,a.useCallback)(()=>{e.hasMore&&s({offset:e.offset+e.limit})},[e.hasMore,e.offset,e.limit,s]),c=(0,a.useCallback)(()=>{e.offset>0&&s({offset:Math.max(0,e.offset-e.limit)})},[e.offset,e.limit,s]);return{...e,search:s,clear:r,setQuery:l,setFilters:i,nextPage:n,previousPage:c}}();return e.get("q"),e.get("book"),e.get("chapter"),e.get("offset"),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[r.jsx("div",{className:"mb-8",children:r.jsx(i.E,{onSearch:e=>{let s=new URLSearchParams;s.set("q",e),b.book&&s.set("book",b.book),b.chapter&&s.set("chapter",b.chapter.toString()),t.push(`/search?${s.toString()}`)},defaultValue:h,placeholder:"Search for Bible verses..."})}),(0,r.jsxs)("div",{className:"mb-6 flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Book:"}),(0,r.jsxs)(x.Ph,{value:b.book||"all",onValueChange:e=>{let s=new URLSearchParams;s.set("q",h),e&&"all"!==e?(s.set("book",e),y({...b,book:e})):y({...b,book:void 0}),t.push(`/search?${s.toString()}`)},children:[r.jsx(x.i4,{className:"w-[180px]",children:r.jsx(x.ki,{placeholder:"All Books"})}),(0,r.jsxs)(x.Bw,{children:[r.jsx(x.Ql,{value:"all",children:"All Books"}),r.jsx(x.Ql,{value:"Philippians",children:"Philippians"}),r.jsx(x.Ql,{value:"Genesis",children:"Genesis"}),r.jsx(x.Ql,{value:"John",children:"John"}),r.jsx(x.Ql,{value:"Romans",children:"Romans"}),r.jsx(x.Ql,{value:"Psalms",children:"Psalms"})]})]})]}),(b.book||b.chapter)&&r.jsx(d.z,{variant:"outline",size:"sm",onClick:()=>{y({}),t.push(`/search?q=${encodeURIComponent(h)}`)},children:"Clear Filters"})]}),v&&r.jsx("div",{className:"mb-6 rounded-md border border-destructive bg-destructive/10 p-4",children:r.jsx("p",{className:"text-sm text-destructive",children:v})}),r.jsx(p,{results:s,total:n,limit:c,offset:u,hasMore:m,query:h,isLoading:g,onPageChange:e=>{let s=new URLSearchParams;s.set("q",h),s.set("offset",e.toString()),b.book&&s.set("book",b.book),b.chapter&&s.set("chapter",b.chapter.toString()),t.push(`/search?${s.toString()}`)},onResultClick:e=>{t.push(`/verse/${e}`)}})]})}function b(){return r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsx("p",{className:"text-muted-foreground",children:"로딩 중..."})}),children:r.jsx(h,{})})}s(3789)},1373:(e,t,s)=>{"use strict";s.d(t,{E:()=>d});var r=s(3227),a=s(3677),l=s(4871),i=s(7587),n=s(8969);let o=a.forwardRef(({className:e,type:t,...s},a)=>r.jsx("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...s}));o.displayName="Input";var c=s(7403);function d({onSearch:e,onClear:t,placeholder:s="Search Bible verses...",defaultValue:d="",debounceMs:u=300,showAutocomplete:m=!1,autocompleteSuggestions:p=[],onSuggestionSelect:f,className:x}){let[h,b]=(0,a.useState)(d),[g,v]=(0,a.useState)(!1),j=(0,a.useRef)(),N=(0,a.useRef)(null),y=(0,a.useRef)(null),w=(0,a.useCallback)(t=>{j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{t.trim()&&e(t.trim())},u)},[e,u]),k=t=>{b(t),v(!1),f?.(t),e(t)};return(0,r.jsxs)("div",{className:(0,n.cn)("relative w-full",x),children:[r.jsx("form",{onSubmit:t=>{t.preventDefault(),h.trim()&&(e(h.trim()),v(!1))},className:"relative",children:(0,r.jsxs)("div",{className:"relative flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[r.jsx(l.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),r.jsx(o,{ref:N,type:"text",value:h,onChange:e=>{let t=e.target.value;b(t),m&&t.length>=2?(v(!0),w(t)):v(!1)},onKeyDown:e=>{"Escape"===e.key&&v(!1)},placeholder:s,className:"pl-10 pr-10","aria-label":"Search","data-testid":"search-input"}),h&&r.jsx("button",{type:"button",onClick:()=>{b(""),v(!1),t?.(),N.current?.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground","aria-label":"Clear search","data-testid":"clear-button",children:r.jsx(i.Z,{className:"h-4 w-4"})})]}),(0,r.jsxs)(c.z,{type:"submit",size:"default",disabled:!h.trim(),"data-testid":"search-button",children:[r.jsx(l.Z,{className:"h-4 w-4 mr-2"}),"Search"]})]})}),m&&g&&p.length>0&&r.jsx("div",{ref:y,className:"absolute z-50 mt-2 w-full rounded-md border bg-popover shadow-md","data-testid":"autocomplete-dropdown",children:r.jsx("ul",{className:"max-h-60 overflow-auto p-1",children:p.map((e,t)=>r.jsx("li",{children:r.jsx("button",{type:"button",onClick:()=>k(e),className:"w-full rounded-sm px-3 py-2 text-left text-sm hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none","data-testid":"autocomplete-suggestion",children:e})},t))})})]})}},1009:(e,t,s)=>{"use strict";s.d(t,{Ol:()=>n,Zb:()=>i,aY:()=>c,ll:()=>o});var r=s(3227),a=s(3677),l=s(8969);let i=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));i.displayName="Card";let n=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",e),...t}));n.displayName="CardHeader";let o=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));o.displayName="CardTitle",a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",e),...t})).displayName="CardDescription";let c=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("p-6 pt-0",e),...t}));c.displayName="CardContent",a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},1563:(e,t,s)=>{"use strict";s.d(t,{Bw:()=>x,Ph:()=>d,Ql:()=>h,i4:()=>m,ki:()=>u});var r=s(3227),a=s(3677),l=s(6792),i=s(5327),n=s(7090),o=s(6942),c=s(8969);let d=l.fC;l.ZA;let u=l.B4,m=a.forwardRef(({className:e,children:t,...s},a)=>(0,r.jsxs)(l.xz,{ref:a,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,r.jsx(l.JO,{asChild:!0,children:r.jsx(i.Z,{className:"h-4 w-4 opacity-50"})})]}));m.displayName=l.xz.displayName;let p=a.forwardRef(({className:e,...t},s)=>r.jsx(l.u_,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:r.jsx(n.Z,{className:"h-4 w-4"})}));p.displayName=l.u_.displayName;let f=a.forwardRef(({className:e,...t},s)=>r.jsx(l.$G,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:r.jsx(i.Z,{className:"h-4 w-4"})}));f.displayName=l.$G.displayName;let x=a.forwardRef(({className:e,children:t,position:s="popper",...a},i)=>r.jsx(l.h_,{children:(0,r.jsxs)(l.VY,{ref:i,className:(0,c.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...a,children:[r.jsx(p,{}),r.jsx(l.l_,{className:(0,c.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),r.jsx(f,{})]})}));x.displayName=l.VY.displayName,a.forwardRef(({className:e,...t},s)=>r.jsx(l.__,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=l.__.displayName;let h=a.forwardRef(({className:e,children:t,...s},a)=>(0,r.jsxs)(l.ck,{ref:a,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(l.wU,{children:r.jsx(o.Z,{className:"h-4 w-4"})})}),r.jsx(l.eT,{children:t})]}));h.displayName=l.ck.displayName,a.forwardRef(({className:e,...t},s)=>r.jsx(l.Z0,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=l.Z0.displayName},7517:(e,t,s)=>{"use strict";s.d(t,{S2:()=>l});var r=s(747);let a=null;function l(){return a||(a=(0,r.eI)(function(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL;if(!e)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");return e}(),function(){let e=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");return e}(),{auth:{persistSession:!1},db:{schema:"public"},global:{headers:{"x-application-name":"bible-transcription-site"}}})),a}process.env.NEXT_PUBLIC_SUPABASE_URL&&l()},3772:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(3189).createProxy)(String.raw`/Users/peter/Dev/bible-transcription-site/apps/web/app/(main)/search/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[193,105,460,904,235,501,495],()=>s(3409));module.exports=r})();