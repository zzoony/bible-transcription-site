"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},3165:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>b,staticGenerationAsyncStorage:()=>d});var s={};t.r(s),t.d(s,{GET:()=>l});var n=t(3036),a=t(5736),o=t(5262),i=t(942),p=t(5655),u=t(8652),c=t(6612);async function l(e){let r=e.nextUrl.searchParams,t=r.get("q"),s=r.get("book"),n=r.get("chapter"),a=r.get("limit"),o=r.get("offset");if(!t||""===t.trim())return i.NextResponse.json({error:'Query parameter "q" is required and cannot be empty'},{status:400});let l=a?Math.min(parseInt(a),100):10,h=o?parseInt(o):0,m=n?parseInt(n):void 0;if(isNaN(l)||l<0)return i.NextResponse.json({error:"Invalid limit parameter (must be 0-100)"},{status:400});if(isNaN(h)||h<0)return i.NextResponse.json({error:"Invalid offset parameter"},{status:400});if(n&&(isNaN(m)||m<0))return i.NextResponse.json({error:"Invalid chapter parameter"},{status:400});try{let e=(0,p.lx)().from("verses").select(`
        id,
        reference,
        niv_text,
        verse_number,
        book_id,
        chapter_id,
        books!inner(name_english, name_korean),
        chapters!inner(chapter_number)
      `,{count:"exact"});if("*"!==t&&(e=e.textSearch("niv_text",t,{type:"websearch",config:"english"})),s){let r=(0,u.iJ)(s)||s;e=e.eq("books.name_english",r)}void 0!==m&&(e=e.eq("chapters.chapter_number",m)),e=e.order("chapters.chapter_number",{ascending:!0}).order("verse_number",{ascending:!0}).range(h,h+l-1);let{data:r,error:n,count:a}=await e;if(n)return console.error("Supabase error:",n),i.NextResponse.json({error:"Database query failed",details:n.message},{status:500});let o=a||0,d=r?.map(e=>{let r=c.rt(e.reference);return{reference:e.reference,book:r?.book||e.books.name_english,chapter:r?.chapter||e.chapters.chapter_number,verse:r?.verse||e.verse_number,text:e.niv_text,snippet:function(e,r){let t=r.toLowerCase().split(/\s+/).filter(e=>e.length>0),s=e;return t.forEach(e=>{let r=RegExp(`(${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");s=s.replace(r,"<mark>$1</mark>")}),s}(e.niv_text,t),relevance_score:1}})||[],b=h+l<o;return i.NextResponse.json({query:t,results:d,total:o,limit:l,offset:h,hasMore:b},{status:200,headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=300, s-maxage=600"}})}catch(e){return console.error("Search API error:",e),i.NextResponse.json({error:"Internal server error",...!1},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"/Users/peter/Dev/bible-transcription-site/apps/web/app/api/search/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:b}=h,f="/api/search/route";function v(){return(0,o.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:d})}},8652:(e,r,t)=>{t.d(r,{hO:()=>a,iJ:()=>n});let s={창세기:"Genesis",출애굽기:"Exodus",레위기:"Leviticus",민수기:"Numbers",신명기:"Deuteronomy",여호수아:"Joshua",사사기:"Judges",룻기:"Ruth",사무엘상:"1 Samuel",사무엘하:"2 Samuel",열왕기상:"1 Kings",열왕기하:"2 Kings",역대상:"1 Chronicles",역대하:"2 Chronicles",에스라:"Ezra",느헤미야:"Nehemiah",에스더:"Esther",욥기:"Job",시편:"Psalms",잠언:"Proverbs",전도서:"Ecclesiastes",아가:"Song of Solomon",이사야:"Isaiah",예레미야:"Jeremiah",예레미야애가:"Lamentations",에스겔:"Ezekiel",다니엘:"Daniel",호세아:"Hosea",요엘:"Joel",아모스:"Amos",오바댜:"Obadiah",요나:"Jonah",미가:"Micah",나훔:"Nahum",하박국:"Habakkuk",스바냐:"Zephaniah",학개:"Haggai",스가랴:"Zechariah",말라기:"Malachi",마태복음:"Matthew",마가복음:"Mark",누가복음:"Luke",요한복음:"John",사도행전:"Acts",로마서:"Romans",고린도전서:"1 Corinthians",고린도후서:"2 Corinthians",갈라디아서:"Galatians",에베소서:"Ephesians",빌립보서:"Philippians",골로새서:"Colossians",데살로니가전서:"1 Thessalonians",데살로니가후서:"2 Thessalonians",디모데전서:"1 Timothy",디모데후서:"2 Timothy",디도서:"Titus",빌레몬서:"Philemon",히브리서:"Hebrews",야고보서:"James",베드로전서:"1 Peter",베드로후서:"2 Peter",요한일서:"1 John",요한이서:"2 John",요한삼서:"3 John",유다서:"Jude",요한계시록:"Revelation"};function n(e){return s[e]||null}function a(e){let r=e.match(/^(.+?)\s+(\d+):(\d+)$/);if(!r)return null;let[,t,s,a]=r,o=n(t);return o?{book:o,chapter:parseInt(s),verse:parseInt(a)}:null}Object.fromEntries(Object.entries(s).map(([e,r])=>[r,e]))},5655:(e,r,t)=>{t.d(r,{lx:()=>o});var s=t(1337);function n(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL;if(!e)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");return e}let a=null;function o(){let e=process.env.SUPABASE_SERVICE_KEY;if(!e)throw Error("Missing env.SUPABASE_SERVICE_KEY");return(0,s.eI)(n(),e,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"}})}process.env.NEXT_PUBLIC_SUPABASE_URL&&(a||(a=(0,s.eI)(n(),function(){let e=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");return e}(),{auth:{persistSession:!1},db:{schema:"public"},global:{headers:{"x-application-name":"bible-transcription-site"}}})))},6612:(e,r,t)=>{t.d(r,{cn:()=>o,rt:()=>i});var s=t(9201),n=t(5832),a=t(8652);function o(...e){return(0,n.m6)((0,s.W)(e))}function i(e){let r=(0,a.hO)(e);if(r)return r;let t=e.match(/^([a-z]+)-(\d+)-(\d+)$/i);if(t)return{book:t[1].charAt(0).toUpperCase()+t[1].slice(1),chapter:parseInt(t[2]),verse:parseInt(t[3])};let s=e.match(/^([\w\s]+?)\s+(\d+):(\d+)$/i);if(s){let e=s[1].trim();return{book:e.charAt(0).toUpperCase()+e.slice(1),chapter:parseInt(s[2]),verse:parseInt(s[3])}}return null}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[193,105,174],()=>t(3165));module.exports=s})();